div
  .passkey-registration-form
    
    = form_with url: "#",
      method: :post,
      data: {\
        controller: "passkey",
        action: "submit->passkey#register",
        "passkey-no-passkeys-found-value": tv(:no_passkeys_found),
        "passkey-email-missing-value": tv(:email_missing),
        "passkey-enter-nickname-value": tv(:passkey_enter_nickname),
        "data-passkey-registration-url-value": new_passkey_path,
        "data-passkey-verification-url-value": passkeys_path\
      },
      html: { class: 'Form default' } do |f|

      .form-group
        .form-label
          = f.label :nickname,
            tv("activerecord.attributes.default.name"),
            class: "FormLabel"

        .form-input
          = f.text_field :nickname,
            id: "passkey_nickname",
            placeholder: "e.g., My iPhone, Work Laptop, YubiKey",
            data: { passkey_target: "nickname" },
            class: 'Input'

        small.text-muted Help you identify this passkey later
      
      .Form-footer.u-mt
        = f.submit tv('passkey.register'),
          class: 'Button Button--primaryAction'
  
  - if current_user.webauthn_credentials.any? 

    h3 = tv('passkey.registered_passkeys')
    ul.passkey-list
      - current_user.webauthn_credentials.each do |credential|
        li
          strong = credential.nickname
          small
            |  "(#{tv('passkey.registered')}: "
            = time_ago_in_words(credential.created_at)
            |  )
          
          = button_to tv('delete'),
            passkey_path(credential),
            method: :delete,
            class: "btn btn-sm btn-danger"
    
    details.help-section
      summary
        strong How to remove passkeys from your device
      
      details
        summary iOS/macOS (iCloud Keychain)
        ol
          li Go to Settings â†’ Passwords
          li Search for "#{request.host}"
          li Select the passkey and tap "Delete"
      
      details
        summary Android/Chrome (Google Password Manager)
        ol
          li Go to passwords.google.com
          li Search for "#{request.host}"
          li Select the passkey and click "Delete"

      details
        summary Windows (Windows Hello)
        ol
          li Go to Settings â†’ Accounts â†’ Sign-in options
          li Select "Passkeys" â†’ Manage passkeys
          li Find and delete the passkey for "#{request.host}"

      details
        summary 1Password, Bitwarden, etc.
        p Open your password manager and search for "#{request.host}", then delete the passkey entry. 

    .backup-recommendations
      h4 ğŸ›¡ï¸ Backup Recommendations
      ul
        li ğŸ“± Register passkeys on multiple devices you use regularly
        li ğŸ”‘ Keep a physical security key (like YubiKey) as a backup
        li ğŸ’¾ Generate recovery codes for emergency access

      = link_to "Manage Recovery Options", security_settings_path, class: "btn btn-secondary" if defined?(security_settings_path)

  - else
    p No passkeys registered yet.
